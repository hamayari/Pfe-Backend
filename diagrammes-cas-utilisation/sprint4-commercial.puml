@startuml
title Diagramme de cas d'utilisation raffiné - Sprint 4 : Commercial Métier

left to right direction

actor "Commercial Métier" as Commercial

rectangle "Sprint 4 - Fonctionnalités Commercial Métier" {
  
  package "Authentification" {
    usecase "S'authentifier" as UC_Auth
    usecase "Se connecter" as UC_Login
    usecase "Se déconnecter" as UC_Logout
  }
  
  package "Gestion du Profil" {
    usecase "Consulter mon profil" as UC_Profile
    usecase "Modifier mon compte" as UC_ModifyAccount
  }
  
  package "Gestion des Conventions (CRUD)" {
    usecase "Gérer les conventions" as UC_ManageConventions
    usecase "Créer une convention" as UC_CreateConvention
    usecase "Saisir les informations de la convention" as UC_EnterConvInfo
    usecase "Définir la référence" as UC_SetRef
    usecase "Définir le libellé" as UC_SetLabel
    usecase "Définir les dates" as UC_SetDates
    usecase "Sélectionner la structure" as UC_SelectStruct
    usecase "Sélectionner le gouvernorat" as UC_SelectGov
    usecase "Définir les modalités de paiement" as UC_SetPaymentTerms
    
    usecase "Modifier une convention" as UC_UpdateConvention
    usecase "Supprimer une convention" as UC_DeleteConvention
    usecase "Consulter les conventions" as UC_ViewConventions
    usecase "Rechercher une convention" as UC_SearchConvention
    usecase "Filtrer les conventions" as UC_FilterConventions
  }
  
  package "Gestion des Factures" {
    usecase "Gérer les factures" as UC_ManageInvoices
    usecase "Générer automatiquement les factures" as UC_GenerateInvoices
    usecase "Calculer les échéances" as UC_CalculateDeadlines
    usecase "Associer les factures à la convention" as UC_LinkInvoices
    
    usecase "Mettre à jour le statut d'une facture" as UC_UpdateInvoiceStatus
    usecase "Marquer comme payée" as UC_MarkPaid
    usecase "Marquer comme non payée" as UC_MarkUnpaid
    usecase "Ajouter une preuve de paiement" as UC_AddProof
    
    usecase "Consulter les factures" as UC_ViewInvoices
    usecase "Visualiser les échéances dépassées" as UC_ViewOverdue
    usecase "Voir la coloration des échéances" as UC_ViewColorCoding
    usecase "Exporter les factures" as UC_ExportInvoices
  }
}

' Relations principales
Commercial --> UC_Auth
Commercial --> UC_Profile
Commercial --> UC_ModifyAccount
Commercial --> UC_ManageConventions
Commercial --> UC_ManageInvoices

' Relations Authentification
UC_Auth ..> UC_Login : <<include>>
UC_Auth ..> UC_Logout : <<extend>>

' Relations Gestion des Conventions
UC_ManageConventions ..> UC_CreateConvention : <<include>>
UC_ManageConventions ..> UC_UpdateConvention : <<include>>
UC_ManageConventions ..> UC_DeleteConvention : <<include>>
UC_ManageConventions ..> UC_ViewConventions : <<include>>
UC_ViewConventions ..> UC_SearchConvention : <<extend>>
UC_ViewConventions ..> UC_FilterConventions : <<extend>>

UC_CreateConvention ..> UC_EnterConvInfo : <<include>>
UC_EnterConvInfo ..> UC_SetRef : <<include>>
UC_EnterConvInfo ..> UC_SetLabel : <<include>>
UC_EnterConvInfo ..> UC_SetDates : <<include>>
UC_EnterConvInfo ..> UC_SelectStruct : <<include>>
UC_EnterConvInfo ..> UC_SelectGov : <<include>>
UC_EnterConvInfo ..> UC_SetPaymentTerms : <<include>>

' Relations Gestion des Factures
UC_ManageInvoices ..> UC_GenerateInvoices : <<include>>
UC_ManageInvoices ..> UC_UpdateInvoiceStatus : <<include>>
UC_ManageInvoices ..> UC_ViewInvoices : <<include>>

UC_GenerateInvoices ..> UC_CalculateDeadlines : <<include>>
UC_GenerateInvoices ..> UC_LinkInvoices : <<include>>

UC_UpdateInvoiceStatus ..> UC_MarkPaid : <<extend>>
UC_UpdateInvoiceStatus ..> UC_MarkUnpaid : <<extend>>
UC_MarkPaid ..> UC_AddProof : <<include>>

UC_ViewInvoices ..> UC_ViewOverdue : <<extend>>
UC_ViewInvoices ..> UC_ViewColorCoding : <<include>>
UC_ViewInvoices ..> UC_ExportInvoices : <<extend>>

@enduml
